!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"),require("../css/css")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../javascript/javascript","../css/css"],t):t(CodeMirror)}(function(t){"use strict";t.defineMode("htmlmixed",function(e,a){var o=t.getMode(e,{name:"xml",htmlMode:!0,multilineTagIndentFactor:a.multilineTagIndentFactor,multilineTagIndentPastTag:a.multilineTagIndentPastTag}),l=t.getMode(e,"css"),n=[],c=a&&a.scriptTypes;if(n.push({matches:/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^$/i,mode:t.getMode(e,"javascript")}),c)for(var r=0;r<c.length;++r){var s=c[r];n.push({matches:s.matches,mode:s.mode&&t.getMode(e,s.mode)})}function i(t,e){var a=e.htmlState.tagName;a&&(a=a.toLowerCase());var c=o.token(t,e.htmlState);if("script"==a&&/\btag\b/.test(c)&&">"==t.current()){var r=t.string.slice(Math.max(0,t.pos-100),t.pos).match(/\btype\s*=\s*("[^"]+"|'[^']+'|\S+)[^<]*$/i);(r=r?r[1]:"")&&/[\"\']/.test(r.charAt(0))&&(r=r.slice(1,r.length-1));for(var s=0;s<n.length;++s){var i=n[s];if("string"==typeof i.matches?r==i.matches:i.matches.test(r)){i.mode&&(e.token=d,e.localMode=i.mode,e.localState=i.mode.startState&&i.mode.startState(o.indent(e.htmlState,"")));break}}}else"style"==a&&/\btag\b/.test(c)&&">"==t.current()&&(e.token=u,e.localMode=l,e.localState=l.startState(o.indent(e.htmlState,"")));return c}function m(t,e,a){var o=t.current(),l=o.search(e);return l>-1?t.backUp(o.length-l):o.match(/<\/?$/)&&(t.backUp(o.length),t.match(e,!1)||t.match(o)),a}function d(t,e){return t.match(/^<\/\s*script\s*>/i,!1)?(e.token=i,e.localState=e.localMode=null,null):m(t,/<\/\s*script\s*>/,e.localMode.token(t,e.localState))}function u(t,e){return t.match(/^<\/\s*style\s*>/i,!1)?(e.token=i,e.localState=e.localMode=null,null):m(t,/<\/\s*style\s*>/,l.token(t,e.localState))}return n.push({matches:/./,mode:t.getMode(e,"text/plain")}),{startState:function(){return{token:i,localMode:null,localState:null,htmlState:o.startState()}},copyState:function(e){if(e.localState)var a=t.copyState(e.localMode,e.localState);return{token:e.token,localMode:e.localMode,localState:a,htmlState:t.copyState(o,e.htmlState)}},token:function(t,e){return e.token(t,e)},indent:function(e,a){return!e.localMode||/^\s*<\//.test(a)?o.indent(e.htmlState,a):e.localMode.indent?e.localMode.indent(e.localState,a):t.Pass},innerMode:function(t){return{state:t.localState||t.htmlState,mode:t.localMode||o}}}},"xml","javascript","css"),t.defineMIME("text/html","htmlmixed")});